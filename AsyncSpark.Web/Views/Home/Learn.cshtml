@{
    ViewData["Title"] = "Learn Async/Await";
}

<div class="row justify-content-center mb-4">
    <div class="col-lg-10">
        <div class="text-center mb-4">
            <h1 class="display-4 fw-bold mb-3">
                <i class="bi bi-mortarboard-fill me-2"></i>Learn Async/Await Patterns
            </h1>
            <p class="lead">
                Master C# async programming through interactive examples and real-world scenarios
            </p>
        </div>
    </div>
</div>

<!-- Learning Paths -->
<div class="row g-4 mb-5 justify-content-center">
    <div class="col-lg-10">
        <h2 class="text-center mb-4">
            Choose Your Learning Path
        </h2>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="card h-100 p-4">
                    <div class="d-inline-block p-3 rounded-circle mb-3 bg-primary bg-opacity-10">
                        <i class="bi bi-1-circle-fill fs-1 text-primary"></i>
                    </div>
                    <h4 class="mb-3">Beginner Path</h4>
                    <p class="mb-3">New to async/await? Start here to learn the fundamentals.</p>
                    <ul class="list-unstyled mb-4">
                        <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i>Basic async/await</li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i>Timeouts & cancellation</li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i>Avoiding deadlocks</li>
                    </ul>
                    <a href="#beginner-modules" class="btn btn-primary">
                        <i class="bi bi-arrow-right-circle me-1"></i> Start Learning
                    </a>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 p-4">
                    <div class="d-inline-block p-3 rounded-circle mb-3 bg-secondary bg-opacity-10">
                        <i class="bi bi-2-circle-fill fs-1 text-secondary"></i>
                    </div>
                    <h4 class="mb-3">Intermediate Path</h4>
                    <p class="mb-3">Understand concurrency and resilience patterns.</p>
                    <ul class="list-unstyled mb-4">
                        <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i>Parallel execution</li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i>Polly retry policies</li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i>Resource throttling</li>
                    </ul>
                    <a href="#intermediate-modules" class="btn btn-secondary">
                        <i class="bi bi-arrow-right-circle me-1"></i> Continue Learning
                    </a>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 p-4">
                    <div class="d-inline-block p-3 rounded-circle mb-3 bg-danger bg-opacity-10">
                        <i class="bi bi-3-circle-fill fs-1 text-danger"></i>
                    </div>
                    <h4 class="mb-3">Advanced Path</h4>
                    <p class="mb-3">Deep dive into production-ready patterns.</p>
                    <ul class="list-unstyled mb-4">
                        <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i>Decorator pattern</li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i>Complex scenarios</li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i>Performance tuning</li>
                    </ul>
                    <a href="#advanced-modules" class="btn btn-danger">
                        <i class="bi bi-arrow-right-circle me-1"></i> Master It
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Beginner Modules -->
<div id="beginner-modules" class="row g-4 mb-5 justify-content-center">
    <div class="col-lg-10">
        <h2 class="mb-4">
            <i class="bi bi-1-circle-fill me-2"></i>Beginner Modules
        </h2>

        <div class="accordion" id="beginnerAccordion">
            <!-- Module 1: Basic Async -->
            <div class="accordion-item mb-3">
                <h3 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#module1">
                        <i class="bi bi-play-circle-fill me-2 text-primary"></i>
                        <strong>Module 1: Understanding Async/Await</strong>
                    </button>
                </h3>
                <div id="module1" class="accordion-collapse collapse show" data-bs-parent="#beginnerAccordion">
                    <div class="accordion-body">
                        <p class="lead mb-3">Learn the basics of asynchronous programming in C#.</p>

                        <div class="alert alert-info">
                            <i class="bi bi-lightbulb-fill me-2"></i>
                            <strong>Key Concept:</strong> Async operations free up threads to do other work while waiting for I/O operations to complete.
                        </div>

                        <h5 class="mt-4 mb-3">Try it yourself:</h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="card bg-body-secondary">
                                    <div class="card-body">
                                        <h6 class="card-title">
                                            <i class="bi bi-x-circle text-danger me-2"></i>Without Timeout (Anti-pattern)
                                        </h6>
                                        <p class="card-text small">See how a call without timeout protection could hang indefinitely.</p>
                                        <a href="/scalar/v1#tag/1.-Async-Basics/GET/api/weather/slow" class="btn btn-sm btn-outline-danger">
                                            Try API: /weather/slow
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-body-secondary">
                                    <div class="card-body">
                                        <h6 class="card-title">
                                            <i class="bi bi-check-circle text-success me-2"></i>With Timeout (Best Practice)
                                        </h6>
                                        <p class="card-text small">Learn how timeout protection prevents hanging operations.</p>
                                        <a href="/scalar/v1#tag/1.-Async-Basics/GET/api/weather/with-timeout" class="btn btn-sm btn-outline-success">
                                            Try API: /weather/with-timeout
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-warning mt-4">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            <strong>Common Mistake:</strong> Never use <code>.Result</code> or <code>.Wait()</code> - they can cause deadlocks! Always use <code>await</code>.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Module 2: Cancellation -->
            <div class="accordion-item mb-3">
                <h3 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#module2">
                        <i class="bi bi-stop-circle-fill me-2 text-warning"></i>
                        <strong>Module 2: Cancellation Tokens</strong>
                    </button>
                </h3>
                <div id="module2" class="accordion-collapse collapse" data-bs-parent="#beginnerAccordion">
                    <div class="accordion-body">
                        <p class="lead mb-3">Learn to properly handle operation cancellation.</p>

                        <div class="alert alert-info">
                            <i class="bi bi-lightbulb-fill me-2"></i>
                            <strong>Key Concept:</strong> Cancellation tokens allow you to stop work that nobody needs anymore, saving server resources.
                        </div>

                        <h5 class="mt-4 mb-3">Interactive Examples:</h5>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="card bg-body-secondary h-100">
                                    <div class="card-body">
                                        <h6 class="card-title text-danger">
                                            <i class="bi bi-x-circle me-2"></i>No Cancellation
                                        </h6>
                                        <p class="card-text small">Operation continues even if you cancel the request.</p>
                                        <a href="/scalar/v1#tag/2.-Cancellation-Patterns/GET/api/cancellation/no-cancellation" class="btn btn-sm btn-outline-danger">
                                            Try It
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-body-secondary h-100">
                                    <div class="card-body">
                                        <h6 class="card-title text-success">
                                            <i class="bi bi-check-circle me-2"></i>With Token
                                        </h6>
                                        <p class="card-text small">Operation stops immediately when cancelled.</p>
                                        <a href="/scalar/v1#tag/2.-Cancellation-Patterns/GET/api/cancellation/with-token" class="btn btn-sm btn-outline-success">
                                            Try It
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-body-secondary h-100">
                                    <div class="card-body">
                                        <h6 class="card-title text-primary">
                                            <i class="bi bi-layers me-2"></i>With Cleanup
                                        </h6>
                                        <p class="card-text small">Shows resource cleanup during cancellation.</p>
                                        <a href="/scalar/v1#tag/2.-Cancellation-Patterns/GET/api/cancellation/with-cleanup" class="btn btn-sm btn-outline-primary">
                                            Try It
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-success mt-4">
                            <i class="bi bi-trophy-fill me-2"></i>
                            <strong>Pro Tip:</strong> In production, proper cancellation can reduce server load by 30%+ in user-facing APIs.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Module 3: Task.WhenAll -->
            <div class="accordion-item mb-3">
                <h3 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#module3">
                        <i class="bi bi-lightning-fill me-2 text-warning"></i>
                        <strong>Module 3: Parallel Execution with Task.WhenAll</strong>
                    </button>
                </h3>
                <div id="module3" class="accordion-collapse collapse" data-bs-parent="#beginnerAccordion">
                    <div class="accordion-body">
                        <p class="lead mb-3">Learn when and how to run operations in parallel.</p>

                        <div class="alert alert-info">
                            <i class="bi bi-lightbulb-fill me-2"></i>
                            <strong>Key Concept:</strong> <code>Task.WhenAll</code> runs independent operations concurrently - 5 operations at 1s each = ~1s total, not 5s!
                        </div>

                        <h5 class="mt-4 mb-3">See the Performance Difference:</h5>
                        <a href="/scalar/v1#tag/3.-Concurrency-&-Parallelism/GET/api/concurrency/comparison" class="btn btn-primary mb-3">
                            <i class="bi bi-speedometer2 me-2"></i>Run Performance Comparison
                        </a>

                        <div class="row g-3 mt-3">
                            <div class="col-md-6">
                                <div class="card border-danger">
                                    <div class="card-header bg-danger text-white">
                                        <i class="bi bi-hourglass-split me-2"></i>Sequential (Slow)
                                    </div>
                                    <div class="card-body">
                                        <code class="d-block mb-2">foreach (var item in items)<br/>{<br/>&nbsp;&nbsp;await DoWork(item); // SLOW!<br/>}</code>
                                        <p class="small mb-0">5 operations = ~5 seconds</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-success">
                                    <div class="card-header bg-success text-white">
                                        <i class="bi bi-lightning-fill me-2"></i>Parallel (Fast)
                                    </div>
                                    <div class="card-body">
                                        <code class="d-block mb-2">var tasks = items.Select(DoWork);<br/>await Task.WhenAll(tasks); // FAST!</code>
                                        <p class="small mb-0">5 operations = ~1 second (5x faster!)</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-warning mt-4">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            <strong>Important:</strong> Only use parallel execution when operations are <strong>independent</strong>. If operation B depends on operation A's result, you MUST run them sequentially.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Intermediate Modules -->
<div id="intermediate-modules" class="row g-4 mb-5 justify-content-center">
    <div class="col-lg-10">
        <h2 class="mb-4">
            <i class="bi bi-2-circle-fill me-2"></i>Intermediate Modules
        </h2>

        <div class="accordion" id="intermediateAccordion">
            <!-- Module 4: Polly Resilience -->
            <div class="accordion-item mb-3">
                <h3 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#module4">
                        <i class="bi bi-shield-fill-check me-2 text-success"></i>
                        <strong>Module 4: Resilience with Polly</strong>
                    </button>
                </h3>
                <div id="module4" class="accordion-collapse collapse show" data-bs-parent="#intermediateAccordion">
                    <div class="accordion-body">
                        <p class="lead mb-3">Handle transient failures gracefully with retry policies.</p>

                        <div class="alert alert-info">
                            <i class="bi bi-lightbulb-fill me-2"></i>
                            <strong>Key Concept:</strong> Network blips and temporary API errors are common. Retry policies turn transient failures into successes.
                        </div>

                        <h5 class="mt-4 mb-3">Try Retry Policies:</h5>
                        <a href="/scalar/v1#tag/1.-Async-Basics/GET/api/weather/with-retry" class="btn btn-primary mb-3">
                            <i class="bi bi-arrow-repeat me-2"></i>Try Weather API with Retry
                        </a>

                        <p class="mt-3">Also explore the dedicated <a href="/polly">Polly Demo Page</a> for more examples.</p>

                        <div class="alert alert-success mt-4">
                            <i class="bi bi-trophy-fill me-2"></i>
                            <strong>Best Practice:</strong> Use exponential backoff + jitter to prevent "retry storms" when services recover.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Module 5: Throttling -->
            <div class="accordion-item mb-3">
                <h3 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#module5">
                        <i class="bi bi-speedometer me-2 text-primary"></i>
                        <strong>Module 5: Resource Throttling with Semaphore</strong>
                    </button>
                </h3>
                <div id="module5" class="accordion-collapse collapse" data-bs-parent="#intermediateAccordion">
                    <div class="accordion-body">
                        <p class="lead mb-3">Control concurrency to respect resource limits.</p>

                        <div class="alert alert-info">
                            <i class="bi bi-lightbulb-fill me-2"></i>
                            <strong>Key Concept:</strong> <code>SemaphoreSlim</code> acts like a bouncer - only allowing N operations to run concurrently.
                        </div>

                        <h5 class="mt-4 mb-3">When to Use Throttling:</h5>
                        <ul>
                            <li class="mb-2"><i class="bi bi-database me-2 text-primary"></i>Database connection pools (e.g., max 100 connections)</li>
                            <li class="mb-2"><i class="bi bi-globe me-2 text-primary"></i>External API rate limits (e.g., 10 requests/second)</li>
                            <li class="mb-2"><i class="bi bi-cpu me-2 text-primary"></i>CPU/memory intensive operations</li>
                        </ul>

                        <a href="/scalar/v1#tag/3.-Concurrency-&-Parallelism/GET/api/concurrency/throttled" class="btn btn-primary mt-3">
                            <i class="bi bi-speedometer2 me-2"></i>Try Throttled Execution
                        </a>

                        <p class="mt-3">Or see it in action on the <a href="/bulkcalls">Bulk Calls Demo Page</a>.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Advanced Modules -->
<div id="advanced-modules" class="row g-4 mb-5 justify-content-center">
    <div class="col-lg-10">
        <h2 class="mb-4">
            <i class="bi bi-3-circle-fill me-2"></i>Advanced Modules
        </h2>

        <div class="accordion" id="advancedAccordion">
            <!-- Module 6: Decorator Pattern -->
            <div class="accordion-item mb-3">
                <h3 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#module6">
                        <i class="bi bi-layers-fill me-2 text-info"></i>
                        <strong>Module 6: Decorator Pattern for Async Operations</strong>
                    </button>
                </h3>
                <div id="module6" class="accordion-collapse collapse show" data-bs-parent="#advancedAccordion">
                    <div class="accordion-body">
                        <p class="lead mb-3">Compose cross-cutting concerns cleanly around async operations.</p>

                        <div class="alert alert-info">
                            <i class="bi bi-lightbulb-fill me-2"></i>
                            <strong>Key Concept:</strong> Decorators let you add behavior (logging, caching, retry) without modifying core business logic.
                        </div>

                        <h5 class="mt-4 mb-3">See it in Action:</h5>
                        <p>The <a href="/openweather">Weather API Demo</a> uses decorators for:</p>
                        <ul>
                            <li class="mb-2"><i class="bi bi-file-text me-2 text-primary"></i>Logging decorator - tracks all API calls</li>
                            <li class="mb-2"><i class="bi bi-hdd me-2 text-primary"></i>Caching decorator - prevents duplicate requests</li>
                        </ul>

                        <div class="alert alert-success mt-4">
                            <i class="bi bi-code-square me-2"></i>
                            <strong>Code Example:</strong> Check <code>Program.cs:68-82</code> in the GitHub repo to see the decorator chain setup.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- API Reference -->
<div class="row g-4 mb-5 justify-content-center">
    <div class="col-lg-10">
        <div class="card p-4">
            <h2 class="mb-4">
                <i class="bi bi-braces me-2"></i>Interactive API Documentation
            </h2>
            <p class="lead mb-4">
                All learning modules have corresponding API endpoints you can try directly through our interactive Scalar documentation.
            </p>
            <div class="row g-3">
                <div class="col-md-6">
                    <h5 class="mb-3">API Endpoint Categories:</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="bi bi-tag-fill text-primary me-2"></i>1. Async Basics - Fundamentals</li>
                        <li class="mb-2"><i class="bi bi-tag-fill text-primary me-2"></i>2. Cancellation Patterns</li>
                        <li class="mb-2"><i class="bi bi-tag-fill text-primary me-2"></i>3. Concurrency & Parallelism</li>
                        <li class="mb-2"><i class="bi bi-tag-fill text-primary me-2"></i>4. Resilience & Timeouts</li>
                        <li class="mb-2"><i class="bi bi-tag-fill text-primary me-2"></i>5. Monitoring & Health</li>
                    </ul>
                </div>
                <div class="col-md-6 text-end">
                    <a href="/scalar/v1" class="btn btn-lg btn-primary">
                        <i class="bi bi-braces me-2"></i>Open API Documentation
                    </a>
                    <p class="text-body-secondary mt-3 small">
                        Each endpoint includes detailed explanations, code examples, and "Try it" functionality
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Resources -->
<div class="row g-4 mb-5 justify-content-center">
    <div class="col-lg-10">
        <div class="card p-4">
            <h2 class="mb-4">
                <i class="bi bi-book me-2"></i>Additional Resources
            </h2>
            <div class="row g-4">
                <div class="col-md-6">
                    <h5 class="mb-3">
                        <i class="bi bi-github me-2"></i>For Developers
                    </h5>
                    <p>Want to see the code? Explore the GitHub repository for:</p>
                    <ul>
                        <li>Complete source code with line-by-line comments</li>
                        <li>Unit tests demonstrating patterns</li>
                        <li>API Learning Guide with detailed walkthroughs</li>
                    </ul>
                    <a href="https://github.com/markhazleton/AsyncSpark" class="btn btn-outline-secondary" target="_blank" rel="noopener">
                        <i class="bi bi-github me-2"></i>View on GitHub
                    </a>
                </div>
                <div class="col-md-6">
                    <h5 class="mb-3">
                        <i class="bi bi-journal-text me-2"></i>Articles & Guides
                    </h5>
                    <p>Deep dive into specific topics:</p>
                    <ul>
                        <li><a href="https://markhazleton.com/cancellation-token.html" target="_blank" rel="noopener">Cancellation Tokens in C#</a></li>
                        <li><a href="https://markhazleton.com/decorator-pattern-http-client.html" target="_blank" rel="noopener">Decorator Pattern Guide</a></li>
                        <li><a href="http://www.thepollyproject.org/" target="_blank" rel="noopener">Polly Project Documentation</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
